import{_ as N}from"./BFU05jqY.js";import{f as H,h as I,u as x,r as u,G as v,e as K,a7 as C,W as q,a8 as P,c as i,o as t,l as f,m as z,a as r,k as D,b as E,A as G,H as w,t as _,F as L,q as W,z as S,a9 as J,C as Q}from"#entry";import{d as R}from"./DoL2xymK.js";const X={key:0,class:"modal-css"},Y={class:"modal-dialog-chat-css"},Z={class:"modal-body-chat-css position-relative"},ee={class:"d-flex align-items-center mb-2"},ae=["src"],se={class:"d-flex flex-column justify-content-center"},te={key:0,class:"text-success"},le={key:1,class:"text-danger"},oe={key:0,class:"d-flex"},ie={class:"d-flex p-2 rounded border border-primary text-secondary shadow-sm position-relative",style:{"max-width":"75%","align-items":"center"}},ne=["src"],re={style:{"word-break":"break-word"}},ce={key:1,class:"d-flex justify-content-end"},ue={class:"d-flex p-2 rounded border border-danger text-secondary shadow-sm position-relative",style:{"max-width":"75%","align-items":"center"}},de={style:{"word-break":"break-word"}},me=["src"],pe={key:1,class:"form-check form-switch mt-1 mb-1"},_e={key:2,class:"input-group mt-1"},ve=H({__name:"ChatKuis",props:{data:{type:Object,required:!1,default:()=>({})}},emits:["modal_close"],setup($,{emit:A}){const y=$,M=A,g=I(),{$axiosAuth:O}=x(),{$pusher:fe,$pusherUtils:b}=x(),{$echo:he,$echoUtils:be}=x(),c=u({}),d=u(null);u({chat:!1});let k=u(!1),m=null;const V=u(""),a=u(y.data);v(()=>y.data,o=>{a.value=o,V.value=o.jawab_id},{deep:!0});async function B(){let o=F(),e=a.value.list;a.value.pesan.trim()!==""&&e.push({acak:o,profil_id:c.value?.id,image_show:c.value?.image_show,nama_inisial:c.value?.nama_inisial,color:c.value?.color,text:a.value.pesan,loading:!0});let l=e.length-1;const n=new FormData;n.append("acak",o),n.append("jawab_id",a.value.jawab_id),n.append("pesan",a.value.pesan),n.append("izin_balas",a.value.izin_balas);try{let j=(await O({method:"post",url:"/pesan/jawab",data:n})).data;e[l].code=!1,a.value.pesan=""}catch(s){console.error(s.response?.data||s.message),e[l].code=!1}}function F(o=30){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let l="";for(let n=0;n<o;n++){const s=Math.floor(Math.random()*e.length);l+=e[s]}return l}const T=R(async()=>{c.value=await g.get("profil")?.data},300);v(()=>z(g.get("profil")),(o,e)=>{c.value=o?.data},{deep:!0}),v(()=>a.value?.list,()=>{C(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})},{deep:!0});const p=u([]),h=u(!1);v(()=>p.value,o=>{if(!o||!a.value?.profil_id){h.value=!1;return}const e=o.filter(l=>l.profil_id===a.value.profil_id);h.value=e.length>0},{immediate:!0,deep:!0}),v(()=>a.value.profil_id,(o,e)=>{const l=p.value.filter(n=>n.profil_id===o);h.value=l.length>0},{immediate:!0,deep:!0}),K(async()=>{T(),m=b.reload().subscribe(`presence-menjawab-kuis.${a.value.jawab_id}`),m.bind("aktifitas-jawab",e=>{a.value.izin_balas=e.izin_balas,e.profil_id!=c.value.id&&(a.value.profil_id=e.profil_id,a.value.nama=e.nama_lengkap,a.value.image_show=e.image_show,a.value.nama_inisial=e.nama_inisial,a.value.color=e.color);const l=e.acak;console.log(l);const n=a.value.list.find(s=>s.acak===l);n?n.loading=!1:a.value.list.push({acak:e.acak,profil_id:e.profil_id,image_show:e.image_show,nama_inisial:e.nama_inisial,color:e.color,text:e.text}),k.value=!0,C(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}),m.bind("pusher:subscription_succeeded",e=>{p.value=Object.values(e.members)}),m.bind("pusher:member_added",e=>{p.value.push(e.info)}),m.bind("pusher:member_removed",e=>{p.value=p.value.filter(l=>l.profil_id!==e.info.profil_id)})}),q(()=>b.getStatus()),P(()=>{m&&a.value.jawab_id&&(b.unsubscribe(`presence-menjawab-kuis.${a.value.jawab_id}`),m=null)});function U(){a.value.show=!1,k.value=!1,M("modal_close",!0)}return(o,e)=>{const l=N,n=G("FontAwesomeIcon");return t(),i("div",null,[z(k)||a.value.show?(t(),i("div",X,[r("div",Y,[r("div",Z,[a.value.loading?(t(),D(l,{key:0,message:"",class:"position-center"})):f("",!0),r("button",{class:"btn right-top",onClick:e[0]||(e[0]=s=>U())},[E(n,{icon:["fa","circle-xmark"],class:"fa-2x"})]),r("div",ee,[a.value.image_show?(t(),i("img",{key:0,src:a.value.image_show,class:"avatar-50 me-2 flex-shrink-0"},null,8,ae)):(t(),i("div",{key:1,style:w({backgroundColor:a.value.color}),class:"avatar-50 me-2 flex-shrink-0 d-flex justify-content-center align-items-center text-white"},_(a.value.nama_inisial),5)),r("div",se,[r("strong",null,_(a.value.nama),1),h.value?(t(),i("span",te,"Online")):(t(),i("span",le,"Offline"))])]),r("div",{ref_key:"chatContainer",ref:d,class:"modal-body p-3 position-relative border",style:{"min-height":"400px","max-height":"400px","overflow-y":"auto"}},[(t(!0),i(L,null,W(a.value.list,(s,j)=>(t(),i("div",{key:j,class:"mb-2"},[s.profil_id==c.value.id?(t(),i("div",oe,[r("div",ie,[s.image_show?(t(),i("img",{key:0,src:s.image_show,class:"avatar-30 me-2 flex-shrink-0"},null,8,ne)):(t(),i("div",{key:1,style:w({backgroundColor:s.color}),class:"avatar-30 me-2 flex-shrink-0 d-flex justify-content-center align-items-center text-white"},_(s.nama_inisial),5)),r("span",re,_(s.text),1),s.loading?(t(),D(l,{key:2,message:"",class:"position-center"})):f("",!0)])])):(t(),i("div",ce,[r("div",ue,[r("span",de,_(s.text),1),s.image_show?(t(),i("img",{key:0,src:s.image_show,class:"avatar-30 ms-2 flex-shrink-0"},null,8,me)):(t(),i("div",{key:1,style:w({backgroundColor:s.color}),class:"avatar-30 ms-2 flex-shrink-0 d-flex justify-content-center align-items-center text-white"},_(s.nama_inisial),5))])]))]))),128))],512),a.value.from=="admin"?(t(),i("div",pe,[S(r("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault","onUpdate:modelValue":e[1]||(e[1]=s=>a.value.izin_balas=s)},null,512),[[J,a.value.izin_balas]]),e[3]||(e[3]=r("label",{class:"form-check-label",for:"flexSwitchCheckDefault"},"izinkan membalas",-1))])):f("",!0),a.value.from=="admin"||a.value.izin_balas=="true"?(t(),i("div",_e,[S(r("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.pesan=s),class:"form-control",placeholder:"Tulis pesan...",rows:"2"},null,512),[[Q,a.value.pesan]]),r("button",{class:"btn btn-primary",type:"button",onClick:B}," Kirim ")])):f("",!0)])])])):f("",!0)])}}}),ye=Object.assign(ve,{__name:"ChatKuis"});export{ye as _};
