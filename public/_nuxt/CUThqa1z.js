import{_ as C}from"./BFU05jqY.js";import{f as $,i as S,u as g,r as b,B as P,e as D,c,o as u,l as G,m as k,a as d,b as a,d as v,v as V,S as p}from"#entry";import{u as j}from"./DH0XEKnV.js";const A={key:2,class:"mt-3 d-flex flex-column align-items-center"},M=$({__name:"Notifikasi",setup(F){const{deviceId:_}=j();S().params.user;const w=P(),{$axiosAuth:x}=g(),t=b(!1),{$messaging:r,$getToken:f,$deleteToken:y,$onMessage:K,$isSupported:N}=g(),m=w.public.google.vapidKey,l=b("");async function T(){if(t.value=!0,await Notification.requestPermission()!=="granted"){o("info","Notifikasi ditolak!");return}const s=await f(r,{vapidKey:m});if(s){t.value=!1,l.value=s;try{const e=new FormData;e.append("firebase_id",s),e.append("device_id",_.value);const i=await x({method:"post",url:"/subscribe",data:e});o("success","Berhasil subscribe notifikasi")}catch(e){console.error(e.response?.data||e.message)}}else o("info","Gagal"),t.value=!1}async function h(){t.value=!0;try{await f(r,{vapidKey:m})?await y(r)?(l.value="",o("info","Berhasil berhenti berlangganan notifikasi.")):o("info","Gagal Berhasil berhenti berlangganan notifikasi."):o("info","Tidak ada token aktif"),t.value=!1}catch(n){console.error("Gagal unsubscribe:",n),t.value=!1,o("info","Gagal unsubscribe")}}async function B(){if(!await N()){console.warn("Push notification tidak didukung");return}if(Notification.permission!=="granted"){console.log("Notifikasi belum diizinkan");return}const e=await f(r,{vapidKey:m});e?l.value=e:console.log("Belum subscribe")}function o(n,s){p.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=p.stopTimer,i.onmouseleave=p.resumeTimer}}).fire({icon:n,title:s})}return D(()=>{B()}),(n,s)=>{const e=V("font-awesome-icon"),i=C;return u(),c("div",null,[k(l)?(u(),c("button",{key:1,onClick:h,class:"btn rounded-pill fw-semibold w-100 d-flex align-items-left justify-content-between"},[d("div",null,[a(e,{icon:["fas","bell"],class:"fa-lg text-secondary text-left me-3"}),s[1]||(s[1]=v(" Notifikasi (Aktif) ",-1))]),a(e,{icon:["fas","toggle-on"],class:"fa-lg text-success"})])):(u(),c("button",{key:0,onClick:T,class:"btn rounded-pill fw-semibold w-100 d-flex align-items-left justify-content-between"},[d("div",null,[a(e,{icon:["fas","bell-slash"],class:"fa-lg text-secondary text-left me-3"}),s[0]||(s[0]=v("Notifikasi (Non-aktif) ",-1))]),a(e,{icon:["fas","toggle-off"],class:"fa-lg"})])),k(t)?(u(),c("div",A,[a(i),s[2]||(s[2]=d("small",{class:"text-muted mt-2"},"Memproses...",-1))])):G("",!0)])}}}),z=Object.assign(M,{__name:"Notifikasi"});export{z as _};
