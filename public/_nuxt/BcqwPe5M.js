import{_ as C}from"./BFU05jqY.js";import{f as P,i as S,u as _,r as b,B as j,e as D,c as l,o as u,l as G,m as k,a as d,b as i,d as v,v as M,S as p}from"#entry";import{u as V}from"./DH0XEKnV.js";import{_ as A}from"./DlAUqK2U.js";const O={key:2,class:"mt-3 d-flex flex-column align-items-center"},F=P({__name:"Notifikasi",setup(w){const{deviceId:g}=V();S().params.user;const x=j(),{$axiosAuth:y}=_(),t=b(!1),{$messaging:r,$getToken:f,$deleteToken:N,$onMessage:q,$isSupported:h}=_(),m=x.public.google.vapidKey,c=b("");async function T(){if(t.value=!0,await Notification.requestPermission()!=="granted"){n("info","Notifikasi ditolak!");return}const s=await f(r,{vapidKey:m});if(s){t.value=!1,c.value=s;try{const e=new FormData;e.append("firebase_id",s),e.append("device_id",g.value);const a=await y({method:"post",url:"/subscribe",data:e});n("success","Berhasil subscribe notifikasi")}catch(e){console.error(e.response?.data||e.message)}}else n("info","Gagal"),t.value=!1}async function B(){t.value=!0;try{await f(r,{vapidKey:m})?await N(r)?(c.value="",n("info","Berhasil berhenti berlangganan notifikasi.")):n("info","Gagal Berhasil berhenti berlangganan notifikasi."):n("info","Tidak ada token aktif"),t.value=!1}catch(o){console.error("Gagal unsubscribe:",o),t.value=!1,n("info","Gagal unsubscribe")}}async function $(){if(!await h()){console.warn("Push notification tidak didukung");return}if(Notification.permission!=="granted"){console.log("Notifikasi belum diizinkan");return}const e=await f(r,{vapidKey:m});e?c.value=e:console.log("Belum subscribe")}function n(o,s){p.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:a=>{a.onmouseenter=p.stopTimer,a.onmouseleave=p.resumeTimer}}).fire({icon:o,title:s})}return D(()=>{$()}),(o,s)=>{const e=M("font-awesome-icon"),a=C;return u(),l("div",null,[k(c)?(u(),l("button",{key:1,onClick:B,class:"btn rounded-pill fw-semibold w-100 d-flex align-items-left justify-content-between"},[d("div",null,[i(e,{icon:["fas","bell"],class:"fa-lg text-secondary text-left me-3"}),s[1]||(s[1]=v(" Notifikasi (Aktif) ",-1))]),i(e,{icon:["fas","toggle-on"],class:"fa-lg text-success"})])):(u(),l("button",{key:0,onClick:T,class:"btn rounded-pill fw-semibold w-100 d-flex align-items-left justify-content-between"},[d("div",null,[i(e,{icon:["fas","bell-slash"],class:"fa-lg text-secondary text-left me-3"}),s[0]||(s[0]=v("Notifikasi (Non-aktif) ",-1))]),i(e,{icon:["fas","toggle-off"],class:"fa-lg"})])),k(t)?(u(),l("div",O,[i(a),s[2]||(s[2]=d("small",{class:"text-muted mt-2"},"Memproses...",-1))])):G("",!0)])}}}),J=Object.assign(F,{__name:"Notifikasi"}),I={};function K(w,g){return null}const L=Object.assign(A(I,[["render",K]]),{__name:"PwaManualUpdate"});export{J as _,L as a};
