import{_ as A}from"./BFU05jqY.js";import{f as G,i as I,u as x,r as v,B as D,e as y,c as _,o as d,l as N,m as w,a as l,b as i,d as h,v as T,S as b,k as L,w as V,L as W}from"#entry";import{u as j}from"./DH0XEKnV.js";import{_ as E}from"./BwT3rymJ.js";const K={key:2,class:"mt-3 d-flex flex-column align-items-center"},U=G({__name:"Notifikasi",setup(B){const{deviceId:m}=j();I().params.user;const k=D(),{$axiosAuth:c}=x(),t=v(!1),{$messaging:o,$getToken:u,$deleteToken:C,$onMessage:R,$isSupported:$}=x(),g=k.public.google.vapidKey,p=v("");async function S(){if(t.value=!0,await Notification.requestPermission()!=="granted"){n("info","Notifikasi ditolak!");return}const s=await u(o,{vapidKey:g});if(s){t.value=!1,p.value=s;try{const e=new FormData;e.append("firebase_id",s),e.append("device_id",m.value);const f=await c({method:"post",url:"/subscribe",data:e});n("success","Berhasil subscribe notifikasi")}catch(e){console.error(e.response?.data||e.message)}}else n("info","Gagal"),t.value=!1}async function P(){t.value=!0;try{await u(o,{vapidKey:g})?await C(o)?(p.value="",n("info","Berhasil berhenti berlangganan notifikasi.")):n("info","Gagal Berhasil berhenti berlangganan notifikasi."):n("info","Tidak ada token aktif"),t.value=!1}catch(a){console.error("Gagal unsubscribe:",a),t.value=!1,n("info","Gagal unsubscribe")}}async function M(){if(!await $()){console.warn("Push notification tidak didukung");return}if(Notification.permission!=="granted"){console.log("Notifikasi belum diizinkan");return}const e=await u(o,{vapidKey:g});e?p.value=e:console.log("Belum subscribe")}function n(a,s){b.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:f=>{f.onmouseenter=b.stopTimer,f.onmouseleave=b.resumeTimer}}).fire({icon:a,title:s})}return y(()=>{M()}),(a,s)=>{const e=T("font-awesome-icon"),f=A;return d(),_("div",null,[w(p)?(d(),_("button",{key:1,onClick:P,class:"btn rounded-pill fw-semibold w-100 d-flex align-items-left justify-content-between"},[l("div",null,[i(e,{icon:["fas","bell"],class:"fa-lg text-secondary text-left me-3"}),s[1]||(s[1]=h(" Notifikasi (Aktif) ",-1))]),i(e,{icon:["fas","toggle-on"],class:"fa-lg text-success"})])):(d(),_("button",{key:0,onClick:S,class:"btn rounded-pill fw-semibold w-100 d-flex align-items-left justify-content-between"},[l("div",null,[i(e,{icon:["fas","bell-slash"],class:"fa-lg text-secondary text-left me-3"}),s[0]||(s[0]=h("Notifikasi (Non-aktif) ",-1))]),i(e,{icon:["fas","toggle-off"],class:"fa-lg"})])),w(t)?(d(),_("div",K,[i(f),s[2]||(s[2]=l("small",{class:"text-muted mt-2"},"Memproses...",-1))])):N("",!0)])}}}),Q=Object.assign(U,{__name:"Notifikasi"}),F={class:"menu-icon"},O={class:"menu-arrow"},X={__name:"PwaManualUpdate",setup(B){const m=v(!1);let r=null;y(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(c=>{c.update(),c.addEventListener("updatefound",()=>{r=c.installing,r.addEventListener("statechange",()=>{r.state==="installed"&&(m.value=!0)})})})});const k=()=>{r&&(r.postMessage({type:"SKIP_WAITING"}),setTimeout(()=>window.location.reload(),1e3))};return(c,t)=>{const o=T("font-awesome-icon"),u=E;return w(m)?(d(),L(u,{key:0,to:{},onClick:W(k,["prevent"]),class:"menu-item"},{default:V(()=>[l("div",F,[i(o,{class:"icon",icon:["fas","clock-rotate-left"]})]),t[0]||(t[0]=l("div",{class:"menu-text"},"Update Halaman",-1)),l("div",O,[i(o,{icon:["fas","chevron-right"]})])]),_:1})):N("",!0)}}};export{Q as _,X as a};
